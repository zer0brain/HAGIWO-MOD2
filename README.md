HAGIWO‑MOD2 — Open modular sound modules for Seeed XIAO RP2350
==============================================================

HAGIWO‑MOD2 is a hardware/firmware concept for small, swappable sound modules (instruments, percussions, FX) built around the Seeed Studio XIAO RP2350. This repository contains a set of example modules and a build setup. Each module lives in its own folder and is compiled via a dedicated PlatformIO environment.

Most of the source code was generated by AI. Although tested, things may still be experimental. Use at your own risk—and feel free to design your own module behavior.

Contents
- What is MOD2 (concept)
- Quick start
- Features & hardware
- Hardware I/O map 
- Eurorack integration (quick notes)
- Module index (with env names and paths)
	- See also `MODULES.md` for a detailed index and how to add new modules
- Build & upload
- For developers (programming model)
- Troubleshooting
- Third‑party components
- License

What is MOD2 (concept)
----------------------
MOD2 is a minimal front‑panel and I/O standard for compact synth/FX modules. The firmware defines the musical behavior; the panel controls and inputs are general‑purpose. A “module” in this repo is just a small program that reads inputs and produces audio to the PWM output.

Quick start
-----------
1) Install VS Code and the PlatformIO extension.
2) Open this folder in VS Code.
3) In PlatformIO, select an environment (for example `zer0_cowbell`).
4) Build, Upload, then open the Serial Monitor at 115200 baud.

Features & hardware
- Target: Seeed Studio XIAO RP2350 (Arduino core via Seeed platform)
- Modules include percussions, synth voices, drones, noise/FX, speech, and more
- Lightweight per‑module builds using PlatformIO `build_src_filter`

Hardware I/O map (neutral)
- POT1: A0 — analog input (0..1023). Meaning is defined by the module.
- POT2: A1 — analog input (0..1023). Meaning is defined by the module.
- POT3: A2 — analog input (0..1023). In MOD2 this is shared with the CV jack (see below).
- IN1:  GPIO7 — digital input (Gate/Trigger only; CV not supported on IN1/IN2).
- IN2:  GPIO0 — digital input (Gate/Trigger only; CV not supported on IN1/IN2).
- OUT:  GPIO1 — PWM audio output (10‑bit; 0..1023). Mid ≈ 511/512 when idle.
- LED:  GPIO5 — digital output. Purpose is module‑defined.
- BUTTON: GPIO6 — digital input (use pull‑up). Purpose is module‑defined.

Analog‑shared CV on A2 (POT3)
- In MOD2, the CV jack is passively mixed with POT3 and read on A2. Firmware receives a single combined value (pot + CV); this is by design.
- Expected CV range: 0–5 V. Due to the front‑end op‑amp, the CV is inverted (CV=5 V or POT3=max → ADC≈0 V; CV=0 V or POT3=min → ADC≈3.3 V).
- IN1/IN2 are gate/trigger inputs only and do not accept continuous CV.

Module specs (per HAGIWO)
-------------------------
- Power rails on bus: +12 V, −12 V, +5 V. MOD2 uses the +5 V rail for XIAO and logic.
- Panel size/depth: 4 HP, ~28 mm depth.
- Controls: 3 × potentiometers (100 k linear), 1 × push switch, 1 × LED (brightness via PWM).
- Inputs: 2 × Gate In (IN1/IN2), 1 × CV In shared with POT3 (A2, 0–5 V, inverted at the ADC).
- Output: 1 × audio out, PWM‑derived, AC‑coupled ≈ 10 Vpp.
- Output LPF: rear jumper selects cutoff (toward MCU = higher cutoff e.g. hi‑hat; toward power header = lower cutoff e.g. kick).
- Input protection/tolerance: series resistor + Schottky clamp; validated by the author for +12 V/−12 V DC (1 min) and ±10 V audio‑rate AC (1 min) without damage.
- RP2350 erratum: use pulldown ≤ 8.2 kΩ (reference uses 3.3 k + 4.7 k ≈ 8 k) where applicable.
- Cost notes: 16‑pin power ribbon/socket to reduce cable cost; many parts common with MOD1.

Eurorack integration (quick notes)
----------------------------------
- Power rails: +12 V, −12 V, +5 V are present on the bus. MOD2 uses the +5 V rail for the XIAO and logic as per the official schematic.
- IN1/IN2 gates: Digital only. The input stage uses Schottky clamping and a series resistor and has been validated to tolerate ±12 V DC and ±10 V audio‑rate AC for 1 minute without damage (per author’s test).
- RP2350 note: Use a pulldown ≤8.2 kΩ on the button/inputs (erratum E9); the reference design combines 3.3 kΩ + 4.7 kΩ ≈ 8 kΩ.
- CV input: On POT3 (A2), 0–5 V and inverted as noted above.
- Audio OUT: PWM with RC low‑pass; output level is AC‑coupled ~10 Vpp. The LPF cutoff is selectable via a rear jumper (toward MCU = higher cutoff for hi‑hats; toward power header = lower cutoff for kicks).
- USB note: Disconnect the Eurorack power ribbon when connecting the XIAO to a PC over USB to avoid tying rails together.

Module index
------------

For a complete, evolving list with add‑your‑own instructions, see `MODULES.md`.
The index contains examples across “HAGIWO” and “zer0” series. Treat them as reference implementations—your own modules can map controls and behaviors freely as long as they stick to the I/O pins above.

Build & upload
--------------
- Build one environment at a time. See `platformio.ini` for the complete list.
- Typical baud rate: 115200.
- Artifacts: `.elf` and `.bin` are always produced; `.uf2` requires `picotool`.

For developers (programming model)
----------------------------------
- Framework: Arduino on RP2350. Audio is generated via PWM on GPIO1 with a 10‑bit wrap (1023). Idle output should sit at mid‑rail (~512) to avoid clicks.
- Common pattern: build a short audio buffer (e.g., 4096 samples) on trigger and stream it from an ISR using linear interpolation. Keep the ISR minimal; do heavy work outside with IRQs masked.
- Concurrency: mark ISR‑shared variables as `volatile`; debounce the button; use LED for status only if it helps the UX you define.
- Persistence: If you need it, use Arduino EEPROM emulation (`begin/put/get/commit`).
- Design freedom: POT/IN1/IN2/BTN/LED semantics are entirely up to your module. Document them at the top of your `main.cpp`.
- More guidance: See `docs/AI_MOD2_INSTRUCTIONS.md` and the machine‑readable `docs/AI_MOD2_PROMPT.yml` to bootstrap new modules (human or AI generated).

Troubleshooting
- UF2 not generated: Install `picotool` or just use the `.bin` with your uploader. PlatformIO still finishes successfully.
- Library fetch: For speech (SAM), the library is pulled via `lib_deps` from GitHub. If you need reproducibility, pin a commit using `#<commit-sha>`.
- WSL/paths: On Windows with WSL, use paths like `/mnt/d/...` when running PlatformIO from a Linux shell.

Links
-----
- Official article: https://note.com/solder_state/n/nce8f7defcf98
- ModularGrid: https://modulargrid.net/e/other-unknown-hagiwo-mod2
- Production files/BOM (Patreon): https://www.patreon.com/posts/mod2-rp2350-drum-129202662
- XIAO RP2350 Arduino wiki: https://wiki.seeedstudio.com/xiao_rp2350_arduino/

Third‑party components
- SAM – Software Automatic Mouth (arduino‑SAM) by Phil Schatzmann
	- Upstream: https://github.com/pschatzmann/arduino-SAM
	- Status: Reverse‑engineered/Abandonware; no clear OSS license. Consumed only as external dependency.
	- Details: See `THIRD_PARTY.md`.

License
- CC0‑1.0 Public Domain Dedication (see `LICENSE`).
- Most source files include a header noting AI‑assisted generation.